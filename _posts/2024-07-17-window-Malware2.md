---
layout: single
title: 악성코드(Malware) 분석 기초 - 시큐리티아카데미 8일차
date: 2024-07-17 21:30 +0900
categories: 
    - Windows
#tag: Windows
typora-root-url: ../
toc: true
toc_sticky: true
toc_label: 목차
author_profile: true
comment: true
sidebar:
    nav: "docs"
---

## 악성코드 분석 기초

이번 8일차에는 실습 위주로 진행되서 악성코드 분석을 진행하면서 팁같은 것들을 적어보려고 함.

- 문서 파일에 매크로가 비밀번호가 걸려있다?

  - .doc를 .zip로 변경후 압축 해제
  - vb~~.bin 파일을 hxd를 이용해 DP 문자열 검색 후 DPB를 DPx로 변경
  - 매크로 확인 가능

  <br>

- everything 도구를 이용해 생성되는 파일 확인 가능

  - *.vbs 검색
  - 경로 확인
  - 생성된 vbs 파일 notepad에 끌어오기 

  <br>

- 난독화 매크로 보는 방법

  - 보고 싶은 변수 조사식 추가 
  - 중단점 맨 위로 설정
  - 하나씩 실행하면서 변경되는 값 확인

<br>

- AstroGrep
  - 폴더 내에 많은 하위 폴더까지 찾고 싶은 문자열이 있을 때 사용하면 좋음

<br>

- powershell 로그를 확인하기 위해서 윈도우 검색창에 이벤트 뷰어를 검색해서 응용프로그램 및 서비스 로그에서 확인 가능

<br>

- resource hacker로 아이콘 부분 바이너리 확인 가능 

<br>

### 분석 순서 머릿속으로 그려보기

1. 악성 파일 속성을 눌러 파일 정보들 확인
2. 악성 파일 DIE 또는 PeStudio 도구를 통해서 패킹이 됐는지 확인
3. 바이러스 토탈을 이용해 알려진 악성코드인지 확인, 잘 나오지 않는다면 악성코드 hash값은 고유의 번호로 이 정보로 검색해보기 
4. Process Explorer 도구로 실행 중인 프로세스 찾아 속성 확인
5. Process Monitor 도구로 악성 파일이 실행한 로그를 캡처해 어떤 Command가 실행되었는지 확인 
6. Powershell이 동작하였으면 윈도우의 이벤트 뷰어 -> 응용프로그램 및 서비스 로그에서 Powershell 로그 확인 가능 
7. resource hacker를 이용해 아이콘 부분의 바이너리도 분석 가능 
8. AstroGrep을 이용해 의심가는 문자열 등등을 의심되는 경로에서 한 번에 찾아보기 
9. 해커 서버를 확인하였다면 WireShark를 이용해 ip.dst 필터를 걸어 네트워크 변화 확인하기 
10. pdf 파일이 열리지 않아도 notepad에 끌어오면 확인되는 경우도 있음 
11. 하나씩 분석하다 더 자세히 분석하고 싶다면 x96dbg, IDA, Ghidra 등을 이용해 코드 트레이싱 하면서 자세히 분석해보기 